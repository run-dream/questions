### 为什么网络包里有了IP之后还需要MAC

1. 从历史的角度来说 先有MAC地址,再有IP地址， IP 地址是 TCP/IP协议提出来的
2. 从分层的角度来说 MAC 是数据链路层的地址 IP 是网络层的地址
3. 从路由的角度来说 IP地址本质上是终点地址 它在跳过路由器（hop）的时候不会改变，而MAC地址则是下一跳的地址，每跳过一次路由器都会改变。IP 有定位的功能， MAC 没有。



### 如何查看本机IP地址

``` bash
# windows
ipconfig
# linux
ifconfig
ip addr 
# 区别 net-tools 和 iproute2
```

iproute2 支持的选项

```bash
ip { link | addr | addrlabel | route | rule | neigh | ntable | tunnel | maddr | mroute | mrule | monitor | xfrm | token }
```

### 网络地址分类

- ABCDE分类 

  - 组成

     标志位 网络号 主机号 主机号的长度限制了主机数量 2 ** len(host) - 2

- 私有地址 公有地址

- CIDR 无类型域间选路

  - 组成

    网络号 主机号

###  IP ADDR 信息

- lo loopback 环回接口 用于本机通讯

- eth0 网卡

- net_device flag 

  - BROADCAST 可以发送广播包
  - MULTICAST 可以发送多播包
  - LOWER_UP 网线插着

- MTU 最大传输单元 

  限制的是数据链路层的payload，也就是**上层协议**的大小，例如IP，ICMP等。

  超过会被丢弃或被分片。

- qdisc 排队规则 pfifo pfifo_fast 波段

- tos type of service 服务类型 决定在哪个



### 如何配置IP地址

``` bash
### net-tools
ifconfig eth1 %ip%/%网络号位数%
ifconfig eth1 up 

### iproute2
ip addr add %ip%/%网络号位数% dev eth1
ip link set up eth1
```



### 如何自动配置IP地址

DHCP 动态主机配置协议 (基于UDP协议) 报文包括 MAC 地址

- 步骤

  ![步骤](https://bkimg.cdn.bcebos.com/pic/5ab5c9ea15ce36d3d5e5e08939f33a87e850b1a1?x-bce-process=image/resize,m_lfit,w_640,limit_1/format,f_auto)

- 如何自动安装操作系统

  预启动执行环境 PXE (基于tftp)

  安装完成以后可以通过修改BIOS选项boot优先级来避免每次重启都安装操作系统




### 有哪些网络设备，区别是什么

- Hub  

  转发器  从一个port接受到数据后，就会原样的向其他的所有端口发送刚才收到的数据。

  优点是便宜简单，缺点是冲突 带宽损耗 

  所在层级: 物理层 L1

- Bridge

  网桥 基于MAC地址实现数据转发 只有两个端口

  优点是: 有端口学习,缓存

  所在层级: 数据链路层 L2

- Switch

  交换机 同样是基于MAC地址实现数据转发 有多个端口 处理能力更强

  所在层级: 数据链路层 L2

- Router

  路由器 基于IP地址实现数据转发，链接不同的子网，实现大的网络互联，

  所在层级: 网络层 L3

- Gateway

  网关 用来连接两个不同的网络，这两个网络可能采用了不同的网络协议在通讯。

  由于现在的网络基本都是基于TCP/IP的协议进行通信的，所以，当前常见的路由器，也就充当了网关的角色。

  所在层级: 网络层 L3