### 哪些问题适合使用消息队列来解决？
1. 异步处理。
- 好处: 可以更快地返回结果；减少等待，自然实现了步骤之间的并发，提升系统总体的性能
- 实现：将非关键路径的请求异步处理

2. 流量控制
- 好处: 隔离网关和后端服务，以达到流量控制和保护后端服务的目的
- 实现: 
    - APP <-> Gateway -Produce-> MessageQueue -Consume-> Service 
    优点: 能根据下游的处理能力自动调节流量，达到“削峰填谷”的作用
    缺点: 上下游系统都要将同步调用改为异步消息，增加了系统的复杂度
    -                               APP <-> Gateway <-> Service
        TokenGenerator -Produce-> TokenQueue / Consume

    令牌桶可以简单地用一个有固定容量的消息队列加一个“令牌发生器”来实现：令牌发生器按照预估的处理能力，匀速生产令牌并放入令牌队列（如果队列满了则丢弃令牌），网关在收到请求时去令牌队列消费一个令牌，获取到令牌则继续调用后端秒杀服务，如果获取不到令牌则直接返回秒杀失败。

3. 服务解耦

### 局限性
- 引入消息队列带来的延迟问题；需要高代价的补偿(如分布式事务、对账)
- 增加了系统的复杂度；
- 可能产生数据不一致的问题。
- 有数据丢失风险，如宕机重启，如要保证队列数据可用，需要额外机制保证(如双活容灾)