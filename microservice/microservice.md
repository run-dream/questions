### 微服务概览

### 起源

1. 单体架构

   优势: 易于开发，部署

   劣势: 随着规模变大，可维护性越来越差

2. SOA

3. 微服务 可以理解成SOA的最佳实践

   理论:

   - 小即是美 代码少 bug也少 易于维护
   - 单一职责
   - 尽可能早地创建原型
   - 可移植性比效率更加重要

#### 定义

围绕**业务功能**构建的，服务关注单一业务，服务间采用轻量的消息进行通信机制，可以全自动独立部署，可以使用不同的编程语言和数据存储技术。

优点:

1. 原子服务
2. 独立进程
3. 隔离部署
4. 去中心化服务治理 减少集中化的负载均衡

缺点:

基础设施的建设、复杂度高。

- 分布式系统 引入RPC或者消息传递，来实现进程间通信
- 分区的数据架构
  - 分布式缓存
  - 分布式事务
- 测试复杂度
- 服务模块间的依赖
- 对运维基建的挑战比较大

### 实现

#### 组件服务化

- kit 微服务的基础库（框架）
- service 业务代码 + kit 依赖 + 第三方依赖组成的业务微服务
- RPC + message queue 轻量级通信

#### 按业务组织服务

you build it, you run it。

服务背后的小团队是跨功能的，包含业务所需的全面的技能。

模式：

- 大前端
- 网关接入
- 业务服务
- 平台服务
- 基础设施

#### 去中心化

- 数据去中心化
- 治理去中心和
- 技术去中心化

每个服务独享各自的数据存储服务，不共享数据库和缓存。

#### 基础设施的自动化

- CICD 

  gitlab + gitlab hooks + kubernetes

- Testing

  - 测试环境
  - 单元测试
  - API 自动化测试 YAPI

- 在线运行时

  - kuberbetes
  - Promitheus
  - ELK
  - Control Panel

#### 可用性 & 兼容性设计

- design for failure 思想。微服务架构采用粗粒度的进程间通信，引入了额外的复杂性和需要处理的新问题，如网络延迟、消息格式、负载均衡和容错，忽略其中任何一点都属于对分布式计算的误解。
  - 隔离
  - 超时控制
  - 负载保护
  - 限流
  - 降级
  - 重试
  - 负载均衡
- 时刻谨记保持服务契约的兼容性。发送时要保守，接收时要开放。

### 微服务设计

- APIGateway



### gRPC & 服务发现



### 多集群 & 多租户