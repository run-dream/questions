### 什么是RDB？为什么需要RDB?

定义：

RDB 就是 Redis DataBase 的缩写，是以内存快照的方式来保存Redis的内容。

Redis 提供了两个命令来生成 RDB 文件，分别是 save 和 bgsave。

- save

  在主线程中执行，会导致阻塞。

- bgsave

  创建一个子进程，专门用于写入 RDB 文件，避免了主线程的阻塞，这也是 Redis RDB 文件生成的默认配置。

Redis 借助操作系统提供的写时复制技术（Copy-On-Write, COW），在执行快照的同时，正常处理写操作。

（fork 命令在复制页表的时候可能会导致主进程阻塞）

解决问题：

用 AOF 方法进行故障恢复的时候，需要逐一把操作日志都执行一遍。如果操作日志非常多，Redis 就会恢复得很缓慢，影响到正常使用。

### RDB 有什么优点?有什么缺点?

优点：

可以快速恢复数据库

缺点：

它拍的是一张内存的“大合影”，不可避免地会耗时耗力。虽然，Redis 设计了 bgsave 和写时复制方式，尽可能减少了内存快照对正常读写的影响，但是，频繁快照仍然是不太能接受的。

### 到底怎么对Redis进行持久化比较好？

- 数据不能丢失时，内存快照和 AOF 的混合使用是一个很好的选择
- 如果允许分钟级别的数据丢失，可以只使用 RDB
- 如果只用 AOF，优先使用 everysec 的配置选项，因为它在可靠性和性能之间取了一个平衡。

